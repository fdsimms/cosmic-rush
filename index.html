<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cosmic Rush</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js">
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  </head>
  <body>
    <audio id="audio" src="CosmicRush.ogg" loop="true">

    </audio>
    <main class="main">
      <div class="screen-cover"></div>
      <canvas id="canvas" width="1000" height="600">
      </canvas>
      <div class="background">
      </div>
      <i id="sound-button" class="fa fa-2x fa-volume-off paused" >
      </i>
      <i id="play-button" class="fa fa-2x fa-pause" >
      </i>
      <div class="start-modal">
        <h1>Cosmic Rush</h1>
        <h2>A game by Frankie Simms</h2>
        <p>Enter to start.</p>
      </div>
      <div class="instructions-modal hidden">
        <p>
          Arrow keys to move. Space to shoot. P to pause.
        </p>
      </div>
      <div class="game-over-modal hidden">
        <h1>GAME OVER</h1>
      </div>
    </main>

    <script type="application/javascript" src="vendor/keymaster.js"></script>

    <script type="application/javascript" src="lib/util.js"></script>
    <script type="application/javascript" src="lib/movingObject.js"></script>
    <script type="application/javascript" src="lib/alien.js"></script>
    <script type="application/javascript" src="lib/game.js"></script>
    <script type="application/javascript" src="lib/gameView.js"></script>
    <script type="application/javascript" src="lib/ship.js"></script>
    <script type="application/javascript" src="lib/bullet.js"></script>


    <script type="application/javascript">
       (function () {
         var shipImageWithBoost,
             shipImageNoBoost,
             alienImage1,
             alienImage2,
             alienImage3,
             alienImage4,
             shipImages = [],
             alienImages = [];
          window.addEventListener("blur", function () {
            document.getElementById("audio").pause();
          })
          window.addEventListener("focus", function () {
            var soundButton = document.getElementById("sound-button");
            if (!$(soundButton).hasClass("paused")) {
              document.getElementById("audio").play();
            }
          })

         function loadResources() {
           shipImageWithBoost = new Image();
           shipImageWithBoost.src = "gamedevtuts_sprites/Ship/Spritesheet_64x29.png";
           shipImages.push(shipImageWithBoost);

           shipImageNoBoost = new Image();
           shipImageNoBoost.src = "gamedevtuts_sprites/Ship/Spritesheet_64x29_no_flame.png";
           shipImages.push(shipImageNoBoost);

           alienImage1 = new Image();
           alienImage1.src = "./gamedevtuts_sprites/Enemy/hue_shifted/eSpritesheet_40x30_hue1.png";
           alienImages.push(alienImage1);

           alienImage2 = new Image();
           alienImage2.src = "./gamedevtuts_sprites/Enemy/hue_shifted/eSpritesheet_40x30_hue2.png";
           alienImages.push(alienImage2);

           alienImage3 = new Image();
           alienImage3.src = "./gamedevtuts_sprites/Enemy/hue_shifted/eSpritesheet_40x30_hue3.png";
           alienImages.push(alienImage3);

           alienImage4 = new Image();
           alienImage4.src = "./gamedevtuts_sprites/Enemy/hue_shifted/eSpritesheet_40x30_hue4.png";
           alienImages.push(alienImage4);
         }

         loadResources();

         var soundButton = document.getElementById("sound-button");
         soundButton.addEventListener("click", function () {
           var audio = document.getElementById("audio");

           if ($(this).hasClass("playing")) {
            audio.pause();
            $(this).removeClass("fa-volume-up playing");
            $(this).addClass("paused fa fa-2x fa-volume-off");
          } else {
            audio.play();
            $(this).removeClass("fa-volume-off paused");
            $(this).addClass("playing fa fa-2x fa-volume-up");
          }
         })


         var canvasEl = document.getElementsByTagName("canvas")[0];
         canvasEl.width = SpaceInvaders.Game.DIM_X;
         canvasEl.height = SpaceInvaders.Game.DIM_Y;
         var ctx = canvasEl.getContext("2d");
         var game = new SpaceInvaders.Game(shipImages, alienImages, 1);
         var gameView = new SpaceInvaders.GameView(game, ctx, shipImages, alienImages)
         gameView.bindKeyHandlers();

         var playButton = document.getElementById("play-button");
         playButton.addEventListener("click", function () {
           if ($(this).hasClass("fa-pause")) {
             game.pause();
             $(this).removeClass("fa-pause");
             $(this).addClass("fa fa-2x fa-play");
           } else {
             game.continuePlay();
             $(this).removeClass("fa-play");
             $(this).addClass("fa fa-2x fa-pause");
           }
         })

         gameView.start();

       })();
     </script>
  </body>
</html>
